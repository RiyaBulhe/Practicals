LIBRARY IEEE;
USE IEEE.STD_LOGIC_1164.ALL;
USE IEEE.STD_LOGIC_ARITH.ALL;
USE IEEE.STD_LOGIC_UNSIGNED.ALL;
USE IEEE.numeric_std.ALL;

ENTITY reg IS
    PORT (
        din : IN  STD_LOGIC_VECTOR(3 DOWNTO 0);  -- Data input
        dout : INOUT  STD_LOGIC_VECTOR(3 DOWNTO 0);  -- Data output
        mode1 : IN  STD_LOGIC_VECTOR(1 DOWNTO 0);  -- Mode control signal
        clk : IN  STD_LOGIC;  -- Clock signal
        rst : IN  STD_LOGIC  -- Reset signal
    );
END reg;

ARCHITECTURE Behavioral OF reg IS
    -- Internal signals
    SIGNAL MSBIN, LSBIN : STD_LOGIC;  -- MSB and LSB of the input data
    SIGNAL TEMP : STD_LOGIC_VECTOR(3 DOWNTO 0);  -- Temporary register for SIPO
    SIGNAL CLK_DIV : STD_LOGIC_VECTOR(21 DOWNTO 0);  -- Clock divider signal
BEGIN

    -- Extract MSB and LSB from input data
    MSBIN <= din(3);
    LSBIN <= din(0);

    -- Clock division process (slows down the clock for simulation purposes)
    PROCESS(clk, rst)
    BEGIN
        IF rst = '1' THEN
            CLK_DIV <= (OTHERS => '0');
        ELSIF (clk'EVENT AND clk = '1') THEN
            CLK_DIV <= CLK_DIV + 1;
        END IF;
    END PROCESS;

    -- Main register process (controls data output based on mode1)
    PROCESS(CLK_DIV(21), rst)
    BEGIN
        IF rst = '1' THEN
            dout <= "0000";  -- Clear output
            TEMP <= "0000";  -- Clear temporary register
        ELSIF (CLK_DIV(21)'EVENT AND CLK_DIV(21) = '1') THEN
            CASE mode1 IS
                WHEN "00" =>  -- SISO (Right shift)
                    dout <= MSBIN & dout(3 DOWNTO 1);
                
                WHEN "01" =>  -- PIPO (Parallel In, Parallel Out)
                    dout <= din;
                
                WHEN "10" =>  -- SIPO (Serial In, Parallel Out)
                    TEMP <= MSBIN & TEMP(3 DOWNTO 1);
                    dout <= TEMP;
                
                WHEN "11" =>  -- SISO (Left shift)
                    dout <= dout(2 DOWNTO 0) & LSBIN;
                
                WHEN OTHERS =>  -- Default case
                    dout <= "0000";  -- Clear output
            END CASE;
        END IF;
    END PROCESS;

END Behavioral;
